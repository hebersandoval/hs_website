<% provide(:title, "Post") %>

<!-- PAGE HEADER -->
	<section id="page-header">
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<div class="section-title">
						<h1>Post</h1>
						<span class="st-border"></span>
					</div>
				</div>
			</div>
		</div>
	</section><!-- /PAGE HEADER -->

	<!-- BLOG -->
	<section id="blog">
		<div class="container">
			<div class="row">
				<div class="col-md-9">
					<div class="single-blog">
						<article>
							<div class="post-thumb">
								<%= image_tag("blog/01.jpg", class: "img-responsive", alt: "") %>
							</div>
							<h4 class="post-title"><a href=""><%= @post.title %></a></h4>
							<div class="post-meta text-uppercase">

								<% if current_user.try(:admin?) %>
									<%= link_to edit_post_path(@post), class: "btn btn-default btn-xs" do %>
										<i class="fa fa-pencil" aria-hidden="true"></i>
									<% end %>

				          <%= link_to @post, class: "btn btn-danger btn-xs", method: :delete, data: { confirm: "You sure?" } do %>
				            <i class="fa fa-trash-o" aria-hidden="true"></i>
				          <% end %>
				        <% end %>

								<span class="post-created"><%= @post.created_at.strftime("%B %d, %Y") %></span>

								<!-- Post categories -->
								<% @post.categories.each do |category| %>
									<span>In <a href=""><%= category.name %></a></span>
							  <% end %>

								<span>By <a href=""><%= @post.user.email %></a></span>
							</div>

							<div class="post-article">
								<%= @post.content %>
							</div>
						</article>
					</div>
					<hr>
					<ul class="pager">
						<li class="previous"><%= link_to raw("&larr; Prev"), "", class: "js-prev", "data-id": @post.id %></li>

						<li><%= link_to "Back", posts_path %></li>

						<li class="next"><%= link_to raw("Next &rarr;"), "", class: "js-next", "data-id": @post.id %></li>
					</ul>
					<hr>

					<!-- COMMENT FORM -->
					<div class="row comment">
						<div class="box">
							<div class="col-lg-12">

								<%= form_for([@post, @comment]) do |f| %>
									<%= render 'shared/error_messages', object: f.object %>
									<%= f.text_area :content, class: "form-control", rows: "4", placeholder: "Enter your comment here..." %> <br>
									<%= f.submit class: "form-control" %>
								<% end %>
							<!-- Display all comments -->
							<% @post.comments.each do |comment| %>
								<!-- Left-aligned media object -->
								<div class="media">
									<div class="media-left">
										<%= image_tag("https://unsplash.it/50", size: "60x60") %>
									</div>
									<div class="media-body">
										<h4 class="intro-text"><%= comment.user.name %></h4>
										<p class="postContent"><%= comment.content %></p>
									</div>
								</div>
								<hr>
								<% end %>

							</div>
						</div>
					</div>

				</div>

				<%= render 'shared/sidebar' %>

			</div>
		</div>
	</section>




<script id="comment-template" type="text/x-handlebars-template">
	<div class="row">
		<div class="box">
			<div class="col-lg-12">

				<form class="new_comment" id="new_comment" action="/posts/1/comments" accept-charset="UTF-8" method="post">

				<input name="utf8" type="hidden" value="✓">
				<%= hidden_field_tag :authenticity_token, form_authenticity_token %>


				<!-- this alert is conflicting with other make one appear not two -->
				<div class="flash-alert">
				      <div class="alert alert-dismissible alert-success">
				        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
				        <div id="flash_notice">Successfully created comment!</div>
				      </div>
				</div>

					<textarea class="form-control" rows="4" placeholder="Enter your comment here..." name="comment[content]" id="comment_content"></textarea> <br>

					<input type="submit" name="commit" value="Create Comment" class="form-control" data-disable-with="Create Comment" disabled="">
				</form>
				<!-- Display all comments -->
				<!-- Left-aligned media object -->
				<div class="media">
					<div class="media-left">
						<img src="https://unsplash.it/50" alt="50" width="60" height="60">
					</div>
					<div class="media-body">
						<h4 class="intro-text"><% @post.comments.each do |c| %>
						  <%= c.user.name  %>
						<% end %></h4>
						<p class="postContent">{{content}}</p>
					</div>
				</div>
				<hr>

			</div>
		</div>
	</div>
</script>
